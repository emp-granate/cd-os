name: Build CD OS
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    container: 
      image: archlinux:latest
      options: --privileged
    steps:
      - name: Install Build-Tools
        run: pacman -Syu --noconfirm git archiso devtools

      - name: Code vom Repo holen
        uses: actions/checkout@v4

      - name: ISO Vorbereiten und Bauen
        run: |
          # 1. CachyOS Template holen
          git clone https://github.com
          
          # 2. Deine Dateien in das Template kopieren
          # Wir prüfen erst, ob der Ordner existiert
          if [ -d "airootfs" ]; then
            cp -rv airootfs/* cachyos-live-iso/airootfs/
          fi
          
          # 3. Falls vorhanden, die Paketliste kopieren
          if [ -f "packages.x86_64" ]; then
            cp -v packages.x86_64 cachyos-live-iso/
          fi

          # 4. Skripte ausführbar machen
          chmod -R +x cachyos-live-iso/airootfs/usr/bin/ || true
          
          # 5. Bauvorgang starten
          cd cachyos-live-iso
          ./build.sh -v

      - name: ISO als Download bereitstellen
        uses: actions/upload-artifact@v4
        with:
          name: CD-OS-Image
          path: cachyos-live-iso/out/*.iso
