name: Build CD OS
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    container: 
      image: archlinux:latest
      options: --privileged
    steps:
      - name: Install Build-Tools
        run: pacman -Syu --noconfirm git archiso devtools

      - name: Code vom Repo holen
        uses: actions/checkout@v4

      - name: ISO Vorbereiten und Bauen
        run: |
          # 1. Das CachyOS Werkzeug-Set klonen
          git clone https://github.com build_folder
          
          # 2. Deine BCD-App, Schimmer-Configs und Skripte kopieren
          if [ -d "airootfs" ]; then
            cp -rv airootfs/* build_folder/airootfs/
          fi
          
          # 3. Deine optimierte Paketliste (Tor, Hyprland etc.) einf√ºgen
          if [ -f "packages.x86_64" ]; then
            cp -v packages.x86_64 build_folder/packages.x86_64
          fi

          # 4. Alle Skripte (bcd, toggle-internet, update) scharf schalten
          chmod -R +x build_folder/airootfs/usr/bin/ || true
          
          # 5. Den CachyOS-Motor starten
          cd build_folder
          ./build.sh -v

      - name: ISO als Download bereitstellen
        uses: actions/upload-artifact@v4
        with:
          name: CD-OS-Image
          path: build_folder/out/*.iso
